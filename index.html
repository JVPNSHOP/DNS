<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Public DNS Editor</title>
  <style>
    :root { --fg:#0f172a; --muted:#64748b; --line:#e2e8f0; --accent:#2563eb; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--fg); margin:0; }
    .wrap { max-width: 900px; margin: 24px auto; padding: 16px; }
    h1 { font-size: 22px; margin: 0 0 16px; }
    form { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .row { display: grid; gap: 10px; grid-template-columns: 150px 1fr; align-items: center; }
    label { color: var(--muted); font-size: 14px; }
    input, select { width: 100%; height: 40px; padding: 8px 10px; border:1px solid var(--line); border-radius:10px; font-size: 16px; }
    input[type="checkbox"]{ width:auto; height:auto; }
    .hint { font-size: 12px; color: var(--muted); }
    .btns { display:flex; gap:10px; }
    button { height: 42px; padding: 0 16px; border-radius: 10px; border:1px solid var(--accent); background:var(--accent); color:#fff; font-weight:600; }
    button.ghost { background: #fff; color: var(--accent); }
    #msg { margin-top: 12px; padding: 10px 12px; border-radius: 10px; background: #f8fafc; border:1px solid var(--line); min-height: 44px; white-space: normal; }
    .grid2 { display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    @media (max-width:640px){
      .row{ grid-template-columns: 1fr; }
      .grid2{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Public DNS Editor</h1>

    <!-- Config -->
    <p class="hint">
      Root domain: <b id="rootShow">jvpn.shop</b> • API: <span class="hint" id="apiShow">jk-free-dns.jvpnshop.workers.dev</span>
    </p>

    <form id="dnsForm">
      <div class="row">
        <label for="type">Type</label>
        <select id="type" required>
          <option value="A">A</option>
          <option value="AAAA">AAAA</option>
          <option value="CNAME">CNAME</option>
          <option value="TXT">TXT</option>
          <option value="MX">MX</option>
          <option value="NS">NS</option>
          <option value="CAA">CAA</option>
          <option value="HTTPS">HTTPS</option>
        </select>
      </div>

      <div class="row">
        <label for="host">Host</label>
        <input id="host" type="text" placeholder="sub (or sub.jvpn.shop)" required />
      </div>

      <div class="row">
        <label id="contentLabel" for="content">Content</label>
        <input id="content" type="text" placeholder="IPv4 / IPv6 / target / text" required />
      </div>

      <div class="row" id="prioRow" style="display:none">
        <label for="priority">Priority</label>
        <input id="priority" type="number" min="0" max="65535" placeholder="10 (MX only)" />
      </div>

      <div class="row">
        <label for="ttl">TTL</label>
        <select id="ttl">
          <option value="1">Auto</option>
          <option value="60">60</option>
          <option value="120">120</option>
          <option value="300" selected>300</option>
          <option value="600">600</option>
          <option value="1800">1800</option>
          <option value="3600">3600</option>
        </select>
      </div>

      <div class="row" id="proxiedRow">
        <label for="proxied">Proxy through Cloudflare</label>
        <div><input id="proxied" type="checkbox" checked /> <span class="hint">A / AAAA / CNAME only</span></div>
      </div>

      <div class="btns">
        <button type="submit">Add Record</button>
        <button class="ghost" type="button" id="resetBtn">Reset</button>
      </div>
      <div id="msg"></div>
    </form>

    <p class="hint" style="margin-top:14px">
      Tips: Host ကို <b>full</b> (e.g. <code>app.jvpn.shop</code>) သို့မဟုတ် <b>short</b> (e.g. <code>app</code>) တစ်ခုခုရေးနိုင်တယ်—short ဖြစ်ရင် <code>.jvpn.shop</code> ကို အလိုအလျောက်ပေါင်းပေးမယ်။
    </p>
  </div>

  <script>
    // ===== Settings (edit if needed) =====
    const ROOT = "jvpn.shop";
    const API_URL = "https://jk-free-dns.jvpnshop.workers.dev/dns";
    // =====================================

    document.getElementById("rootShow").textContent = ROOT;
    document.getElementById("apiShow").textContent = API_URL.replace("https://","");

    const typeEl = document.getElementById("type");
    const contentEl = document.getElementById("content");
    const contentLabel = document.getElementById("contentLabel");
    const prioRow = document.getElementById("prioRow");
    const priorityEl = document.getElementById("priority");
    const proxiedRow = document.getElementById("proxiedRow");
    const proxiedEl = document.getElementById("proxied");
    const msg = document.getElementById("msg");
    const hostEl = document.getElementById("host");
    const ttlEl = document.getElementById("ttl");

    function setPlaceholders() {
      const t = typeEl.value;
      prioRow.style.display = (t === "MX") ? "grid" : "none";
      // Proxied only for A/AAAA/CNAME (Cloudflare limitation)
      proxiedRow.style.display = (t === "A" || t === "AAAA" || t === "CNAME") ? "grid" : "none";

      switch (t) {
        case "A":
          contentLabel.textContent = "IPv4 Address";
          contentEl.placeholder = "e.g. 203.0.113.10";
          break;
        case "AAAA":
          contentLabel.textContent = "IPv6 Address";
          contentEl.placeholder = "e.g. 2001:db8::1";
          break;
        case "CNAME":
          contentLabel.textContent = "Target Hostname";
          contentEl.placeholder = "e.g. target.example.com";
          break;
        case "TXT":
          contentLabel.textContent = "TXT Value";
          contentEl.placeholder = "e.g. v=spf1 include:_spf.example ~all";
          break;
        case "MX":
          contentLabel.textContent = "Mail Server";
          contentEl.placeholder = "e.g. mail.example.com";
          break;
        case "NS":
          contentLabel.textContent = "Nameserver Host";
          contentEl.placeholder = "e.g. ns1.example.com";
          break;
        case "CAA":
          contentLabel.textContent = "CAA Value";
          contentEl.placeholder = 'e.g. 0 issue "letsencrypt.org"';
          break;
        case "HTTPS":
          contentLabel.textContent = "Value";
          contentEl.placeholder = "HTTPS record value";
          break;
      }
    }
    typeEl.addEventListener("change", setPlaceholders);
    setPlaceholders();

    function normalizeHost(raw) {
      const v = raw.trim().replace(/\s+/g, "");
      if (!v) return "";
      if (v === ROOT || v.endsWith("." + ROOT)) return v;
      return v + "." + ROOT;
    }

    function show(status, text) {
      msg.textContent = text;
      msg.style.borderColor = status === "ok" ? "#22c55e" : "#ef4444";
      msg.style.background = status === "ok" ? "#ecfdf5" : "#fef2f2";
    }

    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("dnsForm").reset();
      setPlaceholders();
      msg.textContent = "";
      hostEl.focus();
    });

    document.getElementById("dnsForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const type = typeEl.value;
      const name = normalizeHost(hostEl.value);
      const content = contentEl.value.trim();
      const ttl = parseInt(ttlEl.value, 10) || 300;
      const proxied = proxiedEl.checked;

      if (!name || !name.endsWith("." + ROOT) && name !== ROOT) {
        show("err", `❌ Host must be under ${ROOT}`);
        return;
      }
      if (!content) {
        show("err", "❌ Content is required");
        return;
      }

      // Build payload with only necessary fields
      const payload = { type, name, content, ttl };
      if (type === "MX") {
        const p = parseInt(priorityEl.value, 10);
        if (Number.isNaN(p)) { show("err", "❌ MX priority required"); return; }
        payload.priority = p;
      }
      if (type === "A" || type === "AAAA" || type === "CNAME") {
        payload.proxied = proxied;
      }

      show("info", "Processing…");
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (data && data.ok && data.record) {
          const a = data.action || "saved";
          show("ok", `Done ✅ : ${data.record.name} → ${data.record.type} ${data.record.content} (${a})`);
        } else if (data && data.error) {
          show("err", `❌ Error: ${data.error}`);
        } else {
          show("err", `❌ Unexpected response: ${JSON.stringify(data)}`);
        }
      } catch (err) {
        show("err", `❌ Network error: ${err.message}`);
      }
    });
  </script>
</body>
</html>
